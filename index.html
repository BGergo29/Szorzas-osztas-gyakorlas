<!DOCTYPE html>

<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#06D6A0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Szorz√≥t√°bla">
<meta name="description" content="Szorz√≥t√°bla √©s bennfoglal√°s gyakorl√≥ alkalmaz√°s gyerekeknek">
<title>üßÆ Szorz√≥t√°bla Bajnok!</title>
<link rel="manifest" id="manifestLink">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
‚Äìsky: #eef6ff;
‚Äìyellow: #FFD93D;
‚Äìorange: #FF9F1C;
‚Äìpink: #FF6B9D;
‚Äìpurple: #C77DFF;
‚Äìblue: #4CC9F0;
‚Äìteal: #06D6A0;
‚Äìred: #FF4D6D;
‚Äìgreen: #52B788;
‚Äìtext: #2d3250;
‚Äìmuted: #8892b0;
‚Äìshadow: 0 8px 32px rgba(0,0,0,0.10);
‚Äìr: 24px;
}

html, body { height:100%; width:100%; overflow-x:hidden; }

body {
font-family: ‚ÄòBaloo 2‚Äô, cursive;
background: var(‚Äìsky);
color: var(‚Äìtext);
min-height: 100vh;
}

/* BG */
.bg { position:fixed; inset:0; z-index:0; pointer-events:none;
background:linear-gradient(160deg,#eef6ff 0%,#f8edff 50%,#fff8e8 100%); overflow:hidden; }
.bb { position:absolute; border-radius:50%; opacity:.18; animation:bf 9s ease-in-out infinite; }
.bb:nth-child(1){width:260px;height:260px;background:var(‚Äìblue);top:-80px;left:-60px;animation-delay:0s}
.bb:nth-child(2){width:180px;height:180px;background:var(‚Äìpink);top:8%;right:-50px;animation-delay:2s}
.bb:nth-child(3){width:220px;height:220px;background:var(‚Äìyellow);bottom:0;left:-80px;animation-delay:4s}
.bb:nth-child(4){width:140px;height:140px;background:var(‚Äìteal);bottom:15%;right:-30px;animation-delay:1s}
.bb:nth-child(5){width:160px;height:160px;background:var(‚Äìpurple);top:42%;left:45%;animation-delay:3s}
@keyframes bf{0%,100%{transform:translateY(0)scale(1);}50%{transform:translateY(-18px)scale(1.06);}}

/* APP */
#app { position:relative; z-index:1; max-width:520px; margin:0 auto;
padding:18px 14px 40px; min-height:100vh; display:flex; flex-direction:column; }

.screen { display:none; flex-direction:column; flex:1; }
.screen.active { display:flex; }

/* ===== MODAL ===== */
.modal-overlay {
position:fixed; inset:0; z-index:100;
background:rgba(30,30,60,0.55); backdrop-filter:blur(4px);
display:flex; align-items:center; justify-content:center; padding:20px;
animation:fadeIn .2s ease;
}
.modal-overlay.hidden { display:none; }
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

.modal-box {
background:white; border-radius:28px; padding:32px 24px 24px;
max-width:360px; width:100%; text-align:center;
box-shadow:0 20px 60px rgba(0,0,0,0.2);
animation:popIn .25s cubic-bezier(.34,1.56,.64,1);
}
@keyframes popIn{from{opacity:0;transform:scale(.88)}to{opacity:1;transform:scale(1)}}

.modal-icon { font-size:3rem; margin-bottom:10px; display:block; }
.modal-title { font-size:1.4rem; font-weight:900; color:var(‚Äìtext); margin-bottom:8px; }
.modal-sub { font-size:.95rem; font-weight:700; color:var(‚Äìmuted); margin-bottom:22px; line-height:1.5; }
.modal-btns { display:flex; flex-direction:column; gap:10px; }

.mbtn {
width:100%; padding:15px; border-radius:16px; border:none;
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:1rem; font-weight:900;
cursor:pointer; transition:all .15s;
}
.mbtn:hover{transform:translateY(-1px);}
.mbtn:active{transform:scale(.97);}
.mbtn-danger{background:linear-gradient(135deg,var(‚Äìred),#e0305a);color:white;box-shadow:0 4px 16px rgba(255,77,109,.35);}
.mbtn-cancel{background:#f0f2ff;color:var(‚Äìtext);}

/* ===== HOME ===== */
.hero { text-align:center; padding:10px 0 16px; }
.mascot { font-size:76px; line-height:1; display:block; margin-bottom:8px;
filter:drop-shadow(0 6px 12px rgba(0,0,0,.12)); animation:bounce 2.2s ease-in-out infinite; }
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-14px);}}
.hero-title { font-size:clamp(2rem,8vw,2.8rem); font-weight:900; line-height:1.1; color:var(‚Äìtext); margin-bottom:4px; }
.hero-title .hl { background:linear-gradient(135deg,var(‚Äìorange) 0%,var(‚Äìpink) 100%);
-webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
.hero-sub { font-size:1rem; font-weight:700; color:var(‚Äìmuted); }

/* INSTALL BANNER */
.install-banner {
display:none; align-items:center; gap:10px;
background:white; border-radius:16px; padding:12px 14px;
margin-bottom:10px; box-shadow:var(‚Äìshadow);
border:2px solid #d8f0ff;
}
.install-banner.visible { display:flex; }
.install-text { flex:1; font-size:.85rem; font-weight:800; color:var(‚Äìtext); }
.install-text small { display:block; font-size:.75rem; color:var(‚Äìmuted); font-weight:700; }
.install-btn { padding:8px 14px; border-radius:12px; border:none;
background:linear-gradient(135deg,var(‚Äìblue),#4a9fd4);color:white;
font-family:‚ÄòBaloo 2‚Äô,cursive;font-size:.85rem;font-weight:900;cursor:pointer;
white-space:nowrap; flex-shrink:0; }

/* TABS */
.section-tabs { display:flex; gap:10px; margin-bottom:12px; }
.stab { flex:1; padding:14px 8px; border-radius:20px; border:3px solid #e0e4f0; background:white;
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:.95rem; font-weight:900; cursor:pointer;
display:flex; flex-direction:column; align-items:center; gap:3px; transition:all .2s;
box-shadow:0 3px 14px rgba(0,0,0,.07); color:var(‚Äìtext); }
.stab .ti { font-size:1.9rem; }
.stab:hover{transform:translateY(-2px);}
.stab.stab-s.active{background:linear-gradient(135deg,#4CC9F0,#7BAFF0);border-color:#4CC9F0;color:white;box-shadow:0 6px 20px rgba(76,201,240,.38);transform:translateY(-3px);}
.stab.stab-b.active{background:linear-gradient(135deg,#FFD93D,#FF9F1C);border-color:#FFD93D;color:white;box-shadow:0 6px 20px rgba(255,159,28,.38);transform:translateY(-3px);}

/* PANEL */
.sel-panel { background:white; border-radius:var(‚Äìr); padding:16px; box-shadow:var(‚Äìshadow);
margin-bottom:12px; display:none; animation:panelIn .25s ease; }
.sel-panel.visible { display:block; }
@keyframes panelIn{from{opacity:0;transform:scale(.95)translateY(8px);}to{opacity:1;transform:scale(1)translateY(0);}}
.panel-head { font-size:.78rem; font-weight:900; text-transform:uppercase; letter-spacing:2.5px; color:var(‚Äìmuted); margin-bottom:10px; }
.all-btn { display:block; width:100%; padding:11px; border-radius:14px; border:3px dashed;
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:.95rem; font-weight:900; cursor:pointer; transition:all .2s; margin-bottom:10px; background:transparent; }
.all-s{border-color:#4CC9F0;color:#0080bb;}
.all-s:hover,.all-s.on{background:linear-gradient(135deg,#4CC9F0,#7BAFF0);color:white;border-style:solid;box-shadow:0 4px 14px rgba(76,201,240,.3);}
.all-b{border-color:#FF9F1C;color:#bb5500;}
.all-b:hover,.all-b.on{background:linear-gradient(135deg,#FFD93D,#FF9F1C);color:white;border-style:solid;box-shadow:0 4px 14px rgba(255,159,28,.3);}
.num-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:7px; }
.nbtn { aspect-ratio:1; border-radius:13px; border:3px solid #e4e7f5; background:#f6f8ff;
color:var(‚Äìtext); font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:1.35rem; font-weight:900;
cursor:pointer; transition:all .14s; display:flex; align-items:center; justify-content:center;
-webkit-tap-highlight-color:transparent; user-select:none; }
.nbtn:hover{transform:scale(1.09);}
.nbtn.sel-s{background:linear-gradient(135deg,#d4f3ff,#b0e8ff);border-color:#4CC9F0;color:#006699;box-shadow:0 4px 10px rgba(76,201,240,.28);transform:scale(1.07);}
.nbtn.sel-b{background:linear-gradient(135deg,#fff3cc,#ffe596);border-color:#FF9F1C;color:#995500;box-shadow:0 4px 10px rgba(255,159,28,.28);transform:scale(1.07);}

.summary-txt { text-align:center; font-size:.88rem; font-weight:700; color:var(‚Äìmuted); margin-bottom:8px; min-height:22px; }
.summary-txt strong { color:var(‚Äìtext); }
.start-btn { width:100%; padding:18px; border-radius:20px; border:none;
background:linear-gradient(135deg,var(‚Äìteal),#3aad7e); color:white;
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:1.3rem; font-weight:900;
cursor:pointer; transition:all .2s;
box-shadow:0 6px 22px rgba(6,214,160,.42); animation:btnPulse 2.5s ease-in-out infinite; letter-spacing:.5px; }
@keyframes btnPulse{0%,100%{box-shadow:0 6px 22px rgba(6,214,160,.42),0 0 0 0 rgba(6,214,160,0);}50%{box-shadow:0 6px 22px rgba(6,214,160,.42),0 0 0 8px rgba(6,214,160,0);}}
.start-btn:hover{transform:translateY(-3px)scale(1.02);}
.start-btn:active{transform:scale(.97);}
.start-btn:disabled{background:#ccc;box-shadow:none;animation:none;cursor:not-allowed;transform:none;}

/* ===== PRACTICE ===== */
.topbar { display:flex; align-items:center; gap:8px; margin-bottom:14px; }
.back-btn { width:42px; height:42px; border-radius:50%; border:2px solid #e0e4f0; background:white;
font-size:1.2rem; cursor:pointer; display:flex; align-items:center; justify-content:center;
box-shadow:0 2px 8px rgba(0,0,0,.07); transition:all .15s; flex-shrink:0; }
.back-btn:hover{transform:scale(1.1);}
.prog-wrap { flex:1; min-width:0; }
.prog-track { height:13px; background:#dde2f0; border-radius:50px; overflow:hidden; margin-bottom:2px; }
.prog-fill { height:100%; background:linear-gradient(90deg,var(‚Äìteal),var(‚Äìblue)); border-radius:50px;
transition:width .4s cubic-bezier(.34,1.56,.64,1); }
.prog-lbl { text-align:center; font-size:.75rem; font-weight:800; color:var(‚Äìmuted); }
.score-tag { background:white; border-radius:12px; padding:5px 9px; font-size:.82rem; font-weight:900;
color:var(‚Äìteal); box-shadow:0 2px 8px rgba(0,0,0,.07); border:2px solid #c8f5e8; flex-shrink:0; }
.timer-tag { background:white; border-radius:12px; padding:5px 9px; font-size:.82rem; font-weight:900;
color:var(‚Äìpurple); box-shadow:0 2px 8px rgba(0,0,0,.07); border:2px solid #e8d8ff; flex-shrink:0;
font-variant-numeric:tabular-nums; min-width:56px; text-align:center; }

/* QUESTION */
.q-card { background:white; border-radius:28px; padding:28px 22px 22px; box-shadow:var(‚Äìshadow);
text-align:center; margin-bottom:14px; position:relative; overflow:hidden; }
.q-card::after { content:‚Äô‚Äô; position:absolute; top:-60px; right:-60px; width:160px; height:160px;
border-radius:50%; background:var(‚Äìblue); opacity:.05; pointer-events:none; }
.type-tag { display:inline-block; padding:5px 16px; border-radius:50px; font-size:.76rem;
font-weight:900; text-transform:uppercase; letter-spacing:2px; margin-bottom:14px; }
.tag-s{background:#e0f6ff;color:#006699;} .tag-b{background:#fff5e0;color:#995500;}
.q-text { font-size:clamp(2.8rem,10vw,4.8rem); font-weight:900; color:var(‚Äìtext); line-height:1; margin-bottom:20px; }
.ans-row { display:flex; align-items:center; justify-content:center; gap:14px; margin-bottom:14px; }
.eq { font-size:2.4rem; font-weight:900; color:var(‚Äìmuted); }
.ans-box { min-width:130px; padding:14px 24px; border-radius:20px;
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:clamp(2.6rem,9vw,3.6rem); font-weight:900;
color:var(‚Äìtext); background:#f0f4ff; border:4px solid #d0d8f8; min-height:80px;
display:flex; align-items:center; justify-content:center; transition:all .18s; letter-spacing:2px; }
.ans-box.active{border-color:var(‚Äìblue);background:#e6f7ff;box-shadow:0 0 0 5px rgba(76,201,240,.14);}
.ans-box.correct{background:#d4fae8;border-color:var(‚Äìteal);color:var(‚Äìteal);animation:cPop .4s ease;}
.ans-box.wrong{background:#ffe0e8;border-color:var(‚Äìred);color:var(‚Äìred);animation:wShake .4s ease;}
@keyframes cPop{0%{transform:scale(1)}40%{transform:scale(1.18)}100%{transform:scale(1)}}
@keyframes wShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}}
.fb-text { font-size:1.05rem; font-weight:800; min-height:28px; transition:all .2s; }
.fb-text.ok{color:var(‚Äìteal);} .fb-text.err{color:var(‚Äìred);}

/* KEYBOARD */
.kb-card { background:white; border-radius:22px; padding:14px 14px 10px; box-shadow:var(‚Äìshadow); margin-bottom:12px; }
.key-row { display:flex; gap:8px; justify-content:center; margin-bottom:8px; }
.key-row:last-child{margin-bottom:0;}
.key { flex:1; height:60px; border-radius:14px; border:2px solid #e0e4f5; background:#f5f7ff;
color:var(‚Äìtext); font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:1.6rem; font-weight:900;
cursor:pointer; transition:all .1s; display:flex; align-items:center; justify-content:center;
-webkit-tap-highlight-color:transparent; user-select:none; box-shadow:0 4px 0 #c8cce8; }
.key:hover{background:#eaedff;}
.key:active{transform:translateY(3px);box-shadow:none;}
.key.del{background:#fff0f3;border-color:#ffd0da;color:var(‚Äìred);font-size:1rem;flex:1.5;box-shadow:0 4px 0 #f5b8c8;}
.key.enter{background:linear-gradient(135deg,#06D6A0,#3aad7e);border-color:transparent;color:white;font-size:1rem;flex:2;box-shadow:0 4px 0 #279e72;}
.key.del:active,.key.enter:active{box-shadow:none;}

/* FINISH BTN */
.finish-btn { display:block; width:100%; padding:14px; border-radius:16px;
border:3px solid #ffd0da; background:#fff5f7; color:var(‚Äìred);
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:1rem; font-weight:900;
cursor:pointer; transition:all .2s; box-shadow:0 3px 10px rgba(255,77,109,.1); }
.finish-btn:hover{background:#ffe0e8;box-shadow:0 4px 14px rgba(255,77,109,.2);transform:translateY(-1px);}
.finish-btn:active{transform:scale(.97);}

/* ===== RESULTS ===== */
.res-hero { background:white; border-radius:28px; padding:28px 20px 20px; box-shadow:var(‚Äìshadow);
text-align:center; margin-bottom:12px; position:relative; overflow:hidden; }
.cf-wrap { position:absolute; inset:0; pointer-events:none; overflow:hidden; }
.cp { position:absolute; border-radius:2px; animation:cfFall 2.5s ease-in forwards; }
@keyframes cfFall{0%{transform:translateY(-20px)rotate(0);opacity:1;}100%{transform:translateY(320px)rotate(720deg);opacity:0;}}
.res-mascot { font-size:68px; display:block; margin-bottom:6px; animation:bounce 2s ease-in-out infinite; }
.pct-big { font-size:3rem; font-weight:900;
background:linear-gradient(135deg,var(‚Äìorange),var(‚Äìpink));
-webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:2px; }
.res-title { font-size:1.7rem; font-weight:900; color:var(‚Äìtext); margin-bottom:2px; }
.res-sub { font-size:.9rem; font-weight:700; color:var(‚Äìmuted); margin-bottom:16px; }
.stars-row { display:flex; justify-content:center; gap:6px; margin-bottom:18px; }
.star { font-size:2.2rem; animation:starPop .4s cubic-bezier(.34,1.56,.64,1) both; }
.star:nth-child(1){animation-delay:.1s}.star:nth-child(2){animation-delay:.25s}.star:nth-child(3){animation-delay:.4s}
@keyframes starPop{from{transform:scale(0)rotate(-30deg);}to{transform:scale(1)rotate(0);}}
.stats-row { display:flex; gap:7px; margin-bottom:14px; flex-wrap:wrap; }
.stat-box { flex:1; min-width:60px; background:#f6f8ff; border-radius:14px; padding:11px 5px; border:2px solid #e4e7f5; }
.stat-val { font-size:1.5rem; font-weight:900; color:var(‚Äìtext); }
.stat-lbl { font-size:.65rem; font-weight:900; color:var(‚Äìmuted); text-transform:uppercase; letter-spacing:1.5px; }
.stat-box.sh{border-color:#b0f0d8;background:#f0fdf8;}.stat-box.sh .stat-val{color:var(‚Äìteal);}
.stat-box.sw{border-color:#ffd0da;background:#fff5f7;}.stat-box.sw .stat-val{color:var(‚Äìred);}
.stat-box.st{border-color:#e8d8ff;background:#f8f4ff;}.stat-box.st .stat-val{color:var(‚Äìpurple);font-size:1.15rem;}

/* Expandable sections */
.exp-btn { display:flex; align-items:center; justify-content:space-between; width:100%;
border-radius:14px; padding:10px 14px; font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:.9rem;
font-weight:900; cursor:pointer; transition:all .2s; margin-top:6px; border:2px solid; }
.exp-btn .arr{transition:transform .2s;}
.exp-btn.open .arr{transform:rotate(90deg);}
.exp-btn-err{background:#fff8e8;border-color:#ffe0a0;color:#995500;}
.exp-btn-err:hover{background:#fff3cc;}
.exp-btn-una{background:#f0f8ff;border-color:#b0d8ff;color:#0066bb;}
.exp-btn-una:hover{background:#e0f0ff;}
.exp-list { display:none; margin-top:7px; background:white; border-radius:14px;
border:2px solid #e4e7f5; overflow:hidden; box-shadow:0 4px 14px rgba(0,0,0,.06); }
.exp-list.open{display:block;}
.exp-row { display:flex; align-items:center; justify-content:space-between; padding:9px 14px;
border-bottom:1px solid #f0f2ff; font-size:.92rem; }
.exp-row:last-child{border-bottom:none;}
.er-q{font-weight:800;color:var(‚Äìtext);}
.er-a-ok{font-weight:900;color:var(‚Äìteal);font-size:1rem;}
.er-a-una{font-weight:900;color:var(‚Äìmuted);font-size:.85rem;}

.res-btns { display:flex; flex-direction:column; gap:9px; }
.big-btn { width:100%; padding:17px; border-radius:18px; border:none;
font-family:‚ÄòBaloo 2‚Äô,cursive; font-size:1.1rem; font-weight:900;
cursor:pointer; transition:all .2s; display:flex; align-items:center; justify-content:center; gap:7px; }
.big-btn:hover{transform:translateY(-2px);}
.big-btn:active{transform:scale(.97);}
.btn-retry{background:linear-gradient(135deg,var(‚Äìpink),var(‚Äìorange));color:white;box-shadow:0 6px 18px rgba(255,107,157,.38);}
.btn-home{background:white;color:var(‚Äìtext);border:2px solid #e0e4f0;box-shadow:0 4px 12px rgba(0,0,0,.06);}

.hidden{display:none!important;}
</style>

</head>
<body>

<div class="bg">
  <div class="bb"></div><div class="bb"></div><div class="bb"></div>
  <div class="bb"></div><div class="bb"></div>
</div>

<!-- MODAL -->

<div class="modal-overlay hidden" id="modal">
  <div class="modal-box">
    <span class="modal-icon" id="modalIcon">üèÅ</span>
    <div class="modal-title" id="modalTitle">Befejezed?</div>
    <div class="modal-sub" id="modalSub">A marad√©k k√©rd√©sek megv√°laszolatlank√©nt ker√ºlnek a statisztik√°ba.</div>
    <div class="modal-btns">
      <button class="mbtn mbtn-danger" id="modalConfirmBtn">Igen, befejezem</button>
      <button class="mbtn mbtn-cancel" onclick="closeModal()">M√©gsem, folytatom</button>
    </div>
  </div>
</div>

<div id="app">

<!-- ===== HOME ===== -->

<div class="screen active" id="homeScreen">
  <div class="hero">
    <span class="mascot">ü¶â</span>
    <div class="hero-title">Szorz√≥t√°bla<br><span class="hl">Bajnok!</span></div>
    <div class="hero-sub">Mire k√©sz√ºlsz ma? üòä</div>
  </div>

  <div class="install-banner" id="installBanner">
    <span style="font-size:1.8rem">üì≤</span>
    <div class="install-text">
      Telep√≠tsd az appot!
      <small>Haszn√°ld internetkapcsolat n√©lk√ºl is</small>
    </div>
    <button class="install-btn" onclick="installApp()">Telep√≠t√©s</button>
  </div>

  <div class="section-tabs">
    <button class="stab stab-s" id="tabS" onclick="switchTab('s')">
      <span class="ti">‚úñÔ∏è</span><span>Szorz√°s</span>
    </button>
    <button class="stab stab-b" id="tabB" onclick="switchTab('b')">
      <span class="ti">‚ûó</span><span>Bennfoglal√°s</span>
    </button>
  </div>

  <div class="sel-panel" id="panelS">
    <div class="panel-head">üîµ Melyik szorz√≥t√°bl√°t?</div>
    <button class="all-btn all-s" id="allSBtn" onclick="toggleAll('s')">‚≠ê Az √∂sszes szorz√≥t√°bla</button>
    <div class="num-grid" id="gridS"></div>
  </div>

  <div class="sel-panel" id="panelB">
    <div class="panel-head">üü° Melyik bennfoglal√≥ t√°bl√°t?</div>
    <button class="all-btn all-b" id="allBBtn" onclick="toggleAll('b')">‚≠ê Az √∂sszes bennfoglal√≥ t√°bla</button>
    <div class="num-grid" id="gridB"></div>
  </div>

  <div class="summary-txt" id="summary">V√°lassz feladatt√≠pust fent, azt√°n sz√°mokat!</div>
  <button class="start-btn" id="startBtn" onclick="startGame()" disabled>üöÄ Rajt! Csin√°ljuk!</button>
</div>

<!-- ===== PRACTICE ===== -->

<div class="screen" id="practiceScreen">
  <div class="topbar">
    <button class="back-btn" onclick="showModal('back')">üè†</button>
    <div class="prog-wrap">
      <div class="prog-track">
        <div class="prog-fill" id="progFill" style="width:0%"></div>
      </div>
      <div class="prog-lbl" id="progLbl">0 / 0</div>
    </div>
    <div class="score-tag" id="scoreTag">‚≠ê 0</div>
    <div class="timer-tag" id="timerTag">‚è± 0:00</div>
  </div>

  <div class="q-card">
    <div class="type-tag" id="typeTag">Szorz√°s</div>
    <div class="q-text" id="qText"></div>
    <div class="ans-row">
      <span class="eq">=</span>
      <div class="ans-box active" id="ansBox">?</div>
    </div>
    <div class="fb-text" id="fbText"></div>
  </div>

  <div class="kb-card">
    <div class="key-row">
      <div class="key" onclick="pressKey('7')">7</div>
      <div class="key" onclick="pressKey('8')">8</div>
      <div class="key" onclick="pressKey('9')">9</div>
      <div class="key del" onclick="pressKey('del')">‚å´ T√∂rl</div>
    </div>
    <div class="key-row">
      <div class="key" onclick="pressKey('4')">4</div>
      <div class="key" onclick="pressKey('5')">5</div>
      <div class="key" onclick="pressKey('6')">6</div>
      <div class="key enter" onclick="pressKey('enter')">‚úî OK</div>
    </div>
    <div class="key-row">
      <div class="key" onclick="pressKey('1')">1</div>
      <div class="key" onclick="pressKey('2')">2</div>
      <div class="key" onclick="pressKey('3')">3</div>
      <div class="key" onclick="pressKey('0')">0</div>
    </div>
  </div>

<button class="finish-btn" id="finishBtn" onclick="showModal('finish')">üèÅ Befejez√©s</button>

</div>

<!-- ===== RESULTS ===== -->

<div class="screen" id="resultsScreen">
  <div class="res-hero">
    <div class="cf-wrap" id="cfWrap"></div>
    <span class="res-mascot" id="resMascot">ü¶â</span>
    <div class="pct-big" id="pctBig">100%</div>
    <div class="res-title" id="resTitle">Szuper!</div>
    <div class="res-sub" id="resSub">Nagyszer≈± munka!</div>
    <div class="stars-row" id="starsRow"></div>
    <div class="stats-row">
      <div class="stat-box">
        <div class="stat-val" id="stTotal">0</div>
        <div class="stat-lbl">√ñsszes</div>
      </div>
      <div class="stat-box sh">
        <div class="stat-val" id="stOk">0</div>
        <div class="stat-lbl">Helyes ‚úÖ</div>
      </div>
      <div class="stat-box sw">
        <div class="stat-val" id="stErr">0</div>
        <div class="stat-lbl">Hib√°s ‚ùå</div>
      </div>
      <div class="stat-box st">
        <div class="stat-val" id="stTime">0:00</div>
        <div class="stat-lbl">‚è± Id≈ë</div>
      </div>
    </div>
    <button class="exp-btn exp-btn-err hidden" id="errBtn" onclick="toggleExp('err')">
      <span>üîç Mit rontottam el?</span><span class="arr">‚ñ∂</span>
    </button>
    <div class="exp-list" id="errList"></div>
    <button class="exp-btn exp-btn-una hidden" id="unaBtn" onclick="toggleExp('una')">
      <span id="unaBtnTxt">üìã Megv√°laszolatlan k√©rd√©sek</span><span class="arr">‚ñ∂</span>
    </button>
    <div class="exp-list" id="unaList"></div>
  </div>

  <div class="res-btns">
    <button class="big-btn btn-retry hidden" id="retryBtn" onclick="retryMistakes()">üîÅ Hib√°kb√≥l √∫j k√∂r!</button>
    <button class="big-btn btn-home" onclick="goHome()">üè† Vissza a f≈ëoldalra</button>
  </div>
</div>

</div><!-- #app -->

<script>
// ===================== STATE =====================
const selS = new Set(), selB = new Set();
let questions=[], wrongQs=[], mistakesLog=[];
let qIdx=0, okCount=0;
let firstTry=true, inp='', locked=false;
let timerInterval=null, startTime=0, elapsedSec=0;
let earlyFinish=false;
let deferredInstallPrompt=null;

// ===================== PWA SETUP =====================
// Inline manifest via blob URL
const manifest = {
  name: "Szorz√≥t√°bla Bajnok!",
  short_name: "Szorz√≥t√°bla",
  description: "Szorz√≥t√°bla √©s bennfoglal√°s gyakorl√≥ gyerekeknek",
  start_url: "./",
  display: "standalone",
  background_color: "#eef6ff",
  theme_color: "#06D6A0",
  orientation: "portrait",
  icons: [
    { src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'%3E%3Crect width='192' height='192' rx='40' fill='%2306D6A0'/%3E%3Ctext x='96' y='130' font-size='110' text-anchor='middle'%3Eü¶â%3C/text%3E%3C/svg%3E", sizes: "192x192", type: "image/svg+xml" },
    { src: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' rx='100' fill='%2306D6A0'/%3E%3Ctext x='256' y='350' font-size='300' text-anchor='middle'%3Eü¶â%3C/text%3E%3C/svg%3E", sizes: "512x512", type: "image/svg+xml" }
  ]
};
const manifestBlob = new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'});
const manifestURL = URL.createObjectURL(manifestBlob);
document.getElementById('manifestLink').setAttribute('href', manifestURL);

// Service Worker (inline via blob)
const swCode = `
const CACHE = 'szorzotabla-v1';
self.addEventListener('install', e => {
  e.waitUntil(
    caches.open(CACHE).then(c => c.addAll(['./', './index.html']))
    .catch(()=>{})
  );
  self.skipWaiting();
});
self.addEventListener('activate', e => {
  e.waitUntil(clients.claim());
});
self.addEventListener('fetch', e => {
  e.respondWith(
    caches.match(e.request).then(r => r || fetch(e.request).catch(() =>
      new Response('<h1>Offline</h1>', {headers:{'Content-Type':'text/html'}})
    ))
  );
});
`;
if ('serviceWorker' in navigator) {
  const swBlob = new Blob([swCode], {type:'application/javascript'});
  const swURL = URL.createObjectURL(swBlob);
  navigator.serviceWorker.register(swURL).catch(()=>{});
}

// Install prompt
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredInstallPrompt = e;
  document.getElementById('installBanner').classList.add('visible');
});
window.addEventListener('appinstalled', () => {
  document.getElementById('installBanner').classList.remove('visible');
  deferredInstallPrompt = null;
});

function installApp() {
  if (!deferredInstallPrompt) return;
  deferredInstallPrompt.prompt();
  deferredInstallPrompt.userChoice.then(() => {
    deferredInstallPrompt = null;
    document.getElementById('installBanner').classList.remove('visible');
  });
}

// ===================== MODAL =====================
let modalAction = null;

function showModal(action) {
  modalAction = action;
  const icon = document.getElementById('modalIcon');
  const title = document.getElementById('modalTitle');
  const sub = document.getElementById('modalSub');
  const confirmBtn = document.getElementById('modalConfirmBtn');

  if (action === 'finish') {
    icon.textContent = 'üèÅ';
    title.textContent = 'Befejezed a k√∂rt?';
    sub.textContent = 'A marad√©k ' + (questions.length - qIdx) + ' k√©rd√©s megv√°laszolatlank√©nt ker√ºl a statisztik√°ba.';
    confirmBtn.textContent = 'Igen, befejezem';
    confirmBtn.className = 'mbtn mbtn-danger';
  } else {
    icon.textContent = 'üè†';
    title.textContent = 'Vissza a f≈ëoldalra?';
    sub.textContent = 'A halad√°sod elv√©sz √©s nem ker√ºl statisztik√°ba.';
    confirmBtn.textContent = 'Igen, kil√©pek';
    confirmBtn.className = 'mbtn mbtn-danger';
  }
  document.getElementById('modal').classList.remove('hidden');
}

function closeModal() {
  document.getElementById('modal').classList.add('hidden');
  modalAction = null;
}

document.getElementById('modalConfirmBtn').addEventListener('click', function() {
  const action = modalAction;
  closeModal();
  if (action === 'finish') {
    earlyFinish = true;
    stopTimer();
    showResults();
  } else if (action === 'back') {
    stopTimer();
    showScreen('homeScreen');
  }
});

// Close modal on overlay click
document.getElementById('modal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ===================== GRIDS =====================
function makeGrid(id, type) {
  const el = document.getElementById(id);
  for (let i=1; i<=10; i++) {
    const d = document.createElement('div');
    d.className='nbtn'; d.id=type+'-'+i; d.textContent=i;
    d.addEventListener('click', ()=>toggleNum(i,type));
    el.appendChild(d);
  }
}
makeGrid('gridS','s'); makeGrid('gridB','b');

function refreshBtn(i,type) {
  const set=type==='s'?selS:selB;
  const el=document.getElementById(type+'-'+i);
  el.className='nbtn'+(set.has(i)?' sel-'+type:'');
}

function toggleNum(i,type) {
  const set=type==='s'?selS:selB;
  if(set.has(i)) set.delete(i); else set.add(i);
  refreshBtn(i,type); refreshAllBtn(type); updateSummary();
}

function refreshAllBtn(type) {
  const set=type==='s'?selS:selB;
  const btn=document.getElementById(type==='s'?'allSBtn':'allBBtn');
  const allOn=set.size===10;
  btn.classList.toggle('on',allOn);
  if(type==='s') btn.textContent=allOn?'‚úÖ Az √∂sszes kiv√°lasztva!':'‚≠ê Az √∂sszes szorz√≥t√°bla';
  else btn.textContent=allOn?'‚úÖ Az √∂sszes kiv√°lasztva!':'‚≠ê Az √∂sszes bennfoglal√≥ t√°bla';
}

function toggleAll(type) {
  const set=type==='s'?selS:selB;
  if(set.size===10) set.clear(); else for(let i=1;i<=10;i++) set.add(i);
  for(let i=1;i<=10;i++) refreshBtn(i,type);
  refreshAllBtn(type); updateSummary();
}

// ===================== TABS =====================
function switchTab(type) {
  document.getElementById('tabS').classList.toggle('active', type==='s');
  document.getElementById('tabB').classList.toggle('active', type==='b');
  document.getElementById('panelS').classList.toggle('visible', type==='s');
  document.getElementById('panelB').classList.toggle('visible', type==='b');
  updateSummary();
}

function updateSummary() {
  const s=selS.size, b=selB.size;
  const btn=document.getElementById('startBtn');
  const sum=document.getElementById('summary');
  if(s===0&&b===0) { sum.innerHTML='V√°lassz feladatt√≠pust fent, azt√°n sz√°mokat!'; btn.disabled=true; return; }
  let parts=[];
  if(s>0) parts.push('<strong>'+s+' szorz√≥t√°bla</strong>');
  if(b>0) parts.push('<strong>'+b+' bennfoglal√≥ t√°bla</strong>');
  sum.innerHTML=parts.join(' + ')+' ‚Üí √∂sszesen <strong>'+(s*10+b*10)+' k√©rd√©s</strong>';
  btn.disabled=false;
}

// ===================== TIMER =====================
function startTimer() {
  startTime=Date.now(); elapsedSec=0;
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    elapsedSec=Math.floor((Date.now()-startTime)/1000);
    document.getElementById('timerTag').textContent='‚è± '+fmtTime(elapsedSec);
  }, 500);
}
function stopTimer() {
  clearInterval(timerInterval);
  elapsedSec=Math.floor((Date.now()-startTime)/1000);
}
function fmtTime(s) {
  const m=Math.floor(s/60), ss=s%60;
  return m+':'+(ss<10?'0':'')+ss;
}

// ===================== GAME =====================
function shuffle(a) {
  for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
  return a;
}

function buildQs(fromWrong=false) {
  if(fromWrong) return wrongQs.map(q=>({...q}));
  const qs=[];
  selS.forEach(n=>{ for(let m=1;m<=10;m++) qs.push({type:'s',a:n,b:m,ans:n*m}); });
  selB.forEach(n=>{ for(let m=1;m<=10;m++) qs.push({type:'b',a:n*m,b:n,ans:m}); });
  return shuffle(qs);
}

function startGame(fromWrong=false) {
  questions=buildQs(fromWrong);
  wrongQs=[]; mistakesLog=[];
  qIdx=0; okCount=0; earlyFinish=false;
  document.getElementById('timerTag').textContent='‚è± 0:00';
  showScreen('practiceScreen');
  startTimer();
  showQ();
}

function showQ() {
  if(qIdx>=questions.length){ stopTimer(); showResults(); return; }
  const q=questions[qIdx];
  firstTry=true; inp=''; locked=false;

  const pct=Math.round(qIdx/questions.length*100);
  document.getElementById('progFill').style.width=pct+'%';
  document.getElementById('progLbl').textContent=qIdx+' / '+questions.length;
  document.getElementById('scoreTag').textContent='‚≠ê '+okCount;

  const tag=document.getElementById('typeTag');
  const qt=document.getElementById('qText');
  if(q.type==='s'){ tag.className='type-tag tag-s'; tag.textContent='‚úñ Szorz√°s'; qt.textContent=q.a+' √ó '+q.b; }
  else { tag.className='type-tag tag-b'; tag.textContent='‚ûó Bennfoglal√°s'; qt.textContent=q.a+' √∑ '+q.b; }

  const box=document.getElementById('ansBox');
  box.textContent='?'; box.className='ans-box active';
  document.getElementById('fbText').textContent='';
  document.getElementById('fbText').className='fb-text';
}

function pressKey(key) {
  if(locked) return;
  const box=document.getElementById('ansBox');
  const fb=document.getElementById('fbText');

  if(key==='del') {
    inp=inp.slice(0,-1);
    box.textContent=inp||'?'; box.className='ans-box active';
    fb.textContent=''; fb.className='fb-text';
  } else if(key==='enter') {
    if(!inp) return;
    checkAns();
  } else {
    if(inp.length>=3) return;
    inp+=key; box.textContent=inp;
    box.className='ans-box active';
  }
}

document.addEventListener('keydown', e=>{
  if(!document.getElementById('practiceScreen').classList.contains('active')) return;
  if(document.getElementById('modal')&&!document.getElementById('modal').classList.contains('hidden')) return;
  if(e.key>='0'&&e.key<='9') pressKey(e.key);
  else if(e.key==='Backspace') pressKey('del');
  else if(e.key==='Enter') pressKey('enter');
});

function checkAns() {
  const q=questions[qIdx];
  const given=parseInt(inp);
  const box=document.getElementById('ansBox');
  const fb=document.getElementById('fbText');

  if(given===q.ans) {
    box.className='ans-box correct'; box.textContent=given;
    fb.textContent=firstTry?'üéâ Helyes! Szuper!':'‚úÖ Helyes! Tov√°bb!';
    fb.className='fb-text ok';
    if(firstTry) okCount++;
    locked=true;
    setTimeout(()=>{ qIdx++; showQ(); }, 900);
  } else {
    if(firstTry) {
      firstTry=false;
      box.className='ans-box wrong';
      fb.textContent='‚ùå Nem j√≥! Pr√≥b√°ld m√©g egyszer!';
      fb.className='fb-text err';
      setTimeout(()=>{ box.className='ans-box active'; box.textContent='?'; inp=''; }, 500);
    } else {
      mistakesLog.push({q});
      wrongQs.push(q);
      box.textContent=given; box.className='ans-box wrong';
      fb.textContent='‚ùå Helyes v√°lasz: '+q.ans;
      fb.className='fb-text err';
      locked=true;
      setTimeout(()=>{ qIdx++; showQ(); }, 1500);
    }
  }
}

// ===================== RESULTS =====================
function showResults() {
  showScreen('resultsScreen');

  const answered=qIdx;
  const total=questions.length;
  const unanswered=earlyFinish?questions.slice(qIdx):[];
  const wrong=answered-okCount;
  const pct=answered>0?Math.round(okCount/answered*100):(total===0?100:0);

  document.getElementById('stTotal').textContent=answered+'/'+total;
  document.getElementById('stOk').textContent=okCount;
  document.getElementById('stErr').textContent=wrong;
  document.getElementById('stTime').textContent=fmtTime(elapsedSec);
  document.getElementById('pctBig').textContent=pct+'%';

  const mascot=(!earlyFinish&&pct===100)?'üèÜ':pct>=80?'üåü':pct>=60?'üòä':'üí™';
  const title=(!earlyFinish&&pct===100)?'T√∂k√©letes!':pct>=80?'Remek munka!':pct>=60?'Sz√©p teljes√≠tm√©ny!':'M√©g egy k√∂r?';
  let sub;
  if(earlyFinish) sub='Kor√°n befejezted ‚Äì '+unanswered.length+' k√©rd√©s maradt.';
  else if(pct===100) sub='Minden feladatot els≈ëre megoldott√°l!';
  else sub=okCount+' helyes v√°lasz '+answered+'-b≈ël.';
  document.getElementById('resMascot').textContent=mascot;
  document.getElementById('resTitle').textContent=title;
  document.getElementById('resSub').textContent=sub;

  const stars=(!earlyFinish&&pct===100)?3:pct>=70?2:pct>=40?1:0;
  const sr=document.getElementById('starsRow');
  sr.innerHTML='';
  for(let i=0;i<3;i++){
    const s=document.createElement('span');
    s.className='star'; s.textContent=i<stars?'‚≠ê':'‚òÜ';
    sr.appendChild(s);
  }

  if(!earlyFinish&&pct>=80) spawnConfetti();

  // Mistakes
  const errBtn=document.getElementById('errBtn');
  const errList=document.getElementById('errList');
  const retryBtn=document.getElementById('retryBtn');
  errList.innerHTML='';
  if(mistakesLog.length>0) {
    errBtn.classList.remove('hidden');
    retryBtn.classList.remove('hidden');
    mistakesLog.forEach(({q})=>{
      const sign=q.type==='s'?'√ó':'√∑';
      const row=document.createElement('div');
      row.className='exp-row';
      row.innerHTML='<span class="er-q">'+q.a+' '+sign+' '+q.b+' = ?</span><span class="er-a-ok">‚Üí '+q.ans+'</span>';
      errList.appendChild(row);
    });
  } else {
    errBtn.classList.add('hidden');
    retryBtn.classList.add('hidden');
  }

  // Unanswered
  const unaBtn=document.getElementById('unaBtn');
  const unaList=document.getElementById('unaList');
  unaList.innerHTML='';
  if(unanswered.length>0) {
    unaBtn.classList.remove('hidden');
    document.getElementById('unaBtnTxt').textContent='üìã Megv√°laszolatlan k√©rd√©sek ('+unanswered.length+' db)';
    unanswered.forEach(q=>{
      const sign=q.type==='s'?'√ó':'√∑';
      const row=document.createElement('div');
      row.className='exp-row';
      row.innerHTML='<span class="er-q">'+q.a+' '+sign+' '+q.b+' = ?</span><span class="er-a-una">= '+q.ans+'</span>';
      unaList.appendChild(row);
    });
    unanswered.forEach(q=>{ if(!wrongQs.includes(q)) wrongQs.push(q); });
    if(wrongQs.length>0) retryBtn.classList.remove('hidden');
  } else {
    unaBtn.classList.add('hidden');
  }
}

function toggleExp(type) {
  const btn=document.getElementById(type==='err'?'errBtn':'unaBtn');
  const list=document.getElementById(type==='err'?'errList':'unaList');
  btn.classList.toggle('open');
  list.classList.toggle('open');
}

function spawnConfetti() {
  const wrap=document.getElementById('cfWrap');
  wrap.innerHTML='';
  const colors=['#FFD93D','#FF6B9D','#4CC9F0','#06D6A0','#C77DFF','#FF9F1C'];
  for(let i=0;i<28;i++){
    const p=document.createElement('div'); p.className='cp';
    const sz=6+Math.random()*8;
    p.style.cssText='left:'+Math.random()*100+'%;top:0;width:'+sz+'px;height:'+sz+'px;background:'+colors[Math.floor(Math.random()*colors.length)]+';animation-delay:'+Math.random()*1.4+'s;animation-duration:'+(1.4+Math.random())+'s;transform:rotate('+Math.random()*360+'deg)';
    wrap.appendChild(p);
  }
}

function retryMistakes() { startGame(true); }
function goHome() { stopTimer(); showScreen('homeScreen'); }

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}

// Init
updateSummary();
</script>

</body>
</html>